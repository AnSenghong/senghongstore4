# THEASTORE - Mobile Legends Diamond Top-Up Platform

## Overview
THEASTORE (ROVYTOP) is a web-based platform for purchasing Mobile Legends: Bang Bang diamonds in Cambodia. The application allows users to top up their game accounts using local payment methods (ABA Pay and KHQR).

**Date Imported:** November 22, 2025
**Date Refactored:** November 22, 2025 - Migrated from PHP to pure JavaScript

## Project Architecture

### Frontend
- **Technology:** Static HTML, CSS, JavaScript
- **Main File:** `index.html`
- **Payment Handler:** `payment.js` (Bakong API integration)
- **Key Features:**
  - User ID and Zone ID verification
  - Diamond package selection (11 to 9288 diamonds)
  - Weekly pass and Twilight pass options
  - Payment method selection (ABA Pay, KHQR)
  - API-based QR code generation via Bakong service
  - Automatic payment verification
  - Modal-based payment flow with live countdown timer

### Backend
- **Type:** Static file server (no backend processing)
- **Server:** Python's built-in HTTP server
- **Note:** All payment processing uses the Bakong API for secure QR generation and verification

### Database
- **Type:** LocalStorage (browser-based)
- **Purpose:** Stores transaction history locally
- **Note:** Transactions are stored in the browser's localStorage. For production use, this should be replaced with a proper backend and database.

### Payment Integration
- **Provider:** Bakong KHQR (Cambodia's national payment system)
- **API:** Bakong API (api.bakong-api.online)
- **Methods:** ABA Pay, KHQR (both use the same KHQR standard)
- **Currency:** USD
- **Merchant Account:** ansenghong@aclb
- **Merchant Name:** ROVYTOP
- **Implementation:** Browser-based API integration with automatic payment verification
- **Notifications:** Telegram bot notifications sent to admin group when payments are confirmed

## Project Structure
```
.
├── index.html              # Main landing page (dark theme)
├── mlbb.html               # Mobile Legends product page
├── freefire.html           # Free Fire product page
├── bloodstrike.html        # Blood Strike product page
├── genshin.html            # Genshin Impact product page
├── zepeto.html             # Zepeto product page
├── roblox.html             # Roblox product page (username/password)
├── terms.html              # Terms & Conditions
├── game-payment.js         # Bakong payment + Telegram notifications
├── product.css             # Product page styles (light theme)
├── homepage.css            # Homepage styles (dark theme)
├── public/                 # Static assets (images, logos)
└── package.json            # NPM configuration
```

## Replit Configuration

### Web Server
- **Server:** Python's built-in HTTP server
- **Port:** 5000 (bound to 0.0.0.0)
- **Command:** `python -m http.server 5000`
- **Note:** Serves static files only

### Dependencies
- Python 3.11 (installed via Replit modules)
- Bakong API (https://api.bakong-api.online)

## Implementation Details

### Payment Flow
1. User enters Mobile Legends User ID and Zone ID
2. User selects diamond package or pass
3. User clicks payment method (ABA Pay or KHQR)
4. JavaScript calls Bakong API to generate secure KHQR payment code
5. QR code image is displayed in a modal for user to scan
6. System automatically checks payment status every 5 seconds
7. Upon successful payment:
   - User is notified in-app
   - Transaction is marked as complete
   - Telegram notification sent to admin group with details (User ID, Zone ID, Item, Amount)
8. Transaction details are stored in browser localStorage
9. 15-minute expiration timer is shown to user

### API Endpoints Used
- **Create QR:** `GET https://api.bakong-api.online/khqr/create`
  - Parameters: amount, bakongid, merchantname
  - Returns: QR code URL, MD5 hash, transaction ID

- **Check Payment:** `GET https://api.bakong-api.online/check_by_md5`
  - Parameters: md5, bakongid
  - Returns: Payment status (responseCode 0 = paid)

### Security Notes
- QR codes are generated by the Bakong API server
- Payment verification is automatic via MD5 hash checking
- Merchant account ID (ansenghong@aclb) is visible in browser code
- Telegram bot token is visible in browser code (consider this for production)
- For enhanced security, consider adding a backend proxy to hide credentials
- Transaction data is stored locally in browser (not persisted server-side)

### Telegram Notifications
- **Bot Token:** Configured in payment.js
- **Group ID:** -4911328110
- **Notification Details:** Includes User ID, Zone ID, Item name, Amount, Transaction ID, and timestamp
- **Trigger:** Sent automatically when payment is confirmed via Bakong API

## Known Limitations
1. **Transaction Storage:** Uses localStorage - data is lost if browser cache is cleared (for production, use a proper database)
2. **JavaScript:** The main script.js is obfuscated, making modifications difficult
3. **No Backend Storage:** Completed transactions are not permanently stored on a server

## API Integration
- **Base URL:** https://v1.camrapidx.com/validate_user/
- **Endpoints:**
  - Mobile_Legends_KH.php?UserID={id}&ZoneID={zone}
  - FreeFire_Global.php?UserID={id}
  - BloodStrick_Global.php?UserID={id}
  - ZEPETO_KH.php?UserID={id}
  - Genshin_Impact.php?UserID={id}
  - Roblox: No API (username/password only)
- **Blocked Regions:** PH, ID, MY (for Mobile Legends)

## Recent Changes
- **2025-11-22:** Initial import to Replit
  - Installed PHP 8.2
  - Configured web server on port 5000
  - Created project documentation

- **2025-11-22:** PHP to JavaScript Migration
  - Removed all PHP backend code
  - Created `payment.js` with Bakong API integration
  - Updated `index.html` to use JavaScript payment handler
  - Switched from PHP server to Python HTTP server
  - Integrated Bakong API for secure QR generation
  - Added automatic payment verification (checks every 5 seconds)
  - Implemented localStorage for transaction tracking
  - Enabled payment buttons (were previously disabled)

- **2025-11-22:** Bakong API Integration
  - Integrated official Bakong API (api.bakong-api.online)
  - Updated merchant account to ansenghong@aclb
  - Implemented automatic payment status checking
  - Added real-time payment verification
  - Simplified architecture by using Bakong API directly
  - Enhanced UX with loading states and payment status updates

- **2025-11-22:** Telegram Notifications
  - Added Telegram bot integration for payment confirmations
  - Notifications sent to group -4911328110 when payment verified
  - Includes detailed order information (User ID, Zone ID, Item, Amount, Transaction ID)
  - Automatic sending when Bakong API confirms payment

## User Preferences
None specified yet.
