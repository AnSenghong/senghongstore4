<!DOCTYPE html>
<html lang="km">

<head>
  <title>Free Fire - Senghong Store</title>
  <meta property="og:title" content="Free Fire - Senghong Store" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <link rel="shortcut icon" href="public/senghong-logo.png" type="image/png" sizes="32x32" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Khmer:wght@100;200;300;400;500;600;700;800;900&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="./product.css" />
</head>

<body>
  <div class="page-container">
    <header class="header">
      <div class="header-left">
        <a href="index.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
        </a>
        <img alt="Senghong Store Logo" src="./public/senghong-logo.png" class="logo" />
      </div>
      <div class="header-right">
        <button class="icon-btn menu-btn" onclick="toggleMenu()">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </header>

    <div class="side-menu" id="sideMenu">
      <div class="menu-header">
        <img src="public/senghong-logo.png" alt="Logo" class="menu-logo" />
        <span class="menu-title">Senghong Store</span>
        <button class="close-menu" onclick="toggleMenu()"><i class="fas fa-times"></i></button>
      </div>
      <nav class="menu-nav">
        <a href="index.html" class="menu-item"><i class="fas fa-home"></i> Home</a>
        <a href="mlbb.html" class="menu-item"><i class="fas fa-gamepad"></i> Mobile Legends</a>
        <a href="freefire.html" class="menu-item active"><i class="fas fa-gamepad"></i> Free Fire</a>
        <a href="terms.html" class="menu-item"><i class="fas fa-file-alt"></i> Terms & Conditions</a>
        <a href="https://t.me/An_Senghong" target="_blank" class="menu-item"><i class="fab fa-telegram"></i> Telegram</a>
      </nav>
      <div class="menu-footer">
        <p>Version 1.0</p>
      </div>
    </div>
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <section class="product-banner">
      <img src="public/banner1.jpg" alt="Free Fire Banner" class="banner-image" />
      <div class="banner-overlay">
        <h1 class="banner-title">Free Fire</h1>
      </div>
    </section>

    <main class="main-content">
      <div class="game-info-card">
        <div class="game-icon-wrapper">
          <img src="https://webstorages.sgp1.digitaloceanspaces.com/web/01K0BWPP3X7Y05WBXGR0NXXQEC.jpeg" alt="Free Fire" class="game-icon" />
        </div>
        <div class="game-details">
          <h2 class="game-name">Free Fire</h2>
          <div class="game-features">
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>សេវាកម្មប្រកបដោយសុវត្ថិភាព</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-clock"></i>
              <span>24h ដំណើរការរហ័សរហួន</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-headset"></i>
              <span>សេវាអតិថិជនគាំទ្រ</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-globe"></i>
              <span>Global Server</span>
            </div>
          </div>
        </div>
      </div>

      <div class="game-description">
        <p>Free Fire is the ultimate survival shooter game available on mobile. Each 10-minute game places you on a remote island where you are pit against 49 other players, all seeking survival.</p>
      </div>

      <div class="verification-section">
        <div class="section-header-box">
          <span class="step-number">1</span>
          <h3>បញ្ជូលលេខអាយឌី</h3>
          <button class="info-btn" onclick="showIdInfo()">
            <i class="fas fa-question-circle"></i>
          </button>
        </div>

        <div class="form-group">
          <label for="userId">User ID <span class="required">*</span></label>
          <input type="text" id="userId" placeholder="User ID" class="form-input" />
        </div>

        <button class="check-btn" onclick="checkUserId()">
          <i class="fas fa-search"></i>
          Check User ID
        </button>

        <div class="verification-result" id="verificationResult" style="display: none;">
          <div class="result-content">
            <div class="result-icon" id="resultIcon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="result-info">
              <span class="result-label">Username:</span>
              <span class="result-value" id="resultUsername">-</span>
            </div>
          </div>
        </div>

        <div class="error-message" id="errorMessage" style="display: none;">
          <i class="fas fa-exclamation-triangle"></i>
          <span id="errorText">Error message here</span>
        </div>
      </div>

      <div class="products-section">
        <div class="section-header-box">
          <span class="step-number">2</span>
          <h3>ជ្រើសរើសកញ្ចប់</h3>
        </div>
        <p class="section-subtitle"><i class="fas fa-star" style="color: #ffc107;"></i> Recommended for You</p>

        <h4 class="category-title">Diamonds</h4>
        <div class="products-grid">
          <div class="product-card" onclick="selectProduct('25 Diamonds', 0.23, '25')">
            <div class="product-image">
              <img src="public/ff-diamond.png" alt="Diamonds" />
            </div>
            <div class="product-info">
              <span class="product-name">25</span>
              <span class="product-price">$0.23</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('100 Diamonds', 0.83, '100')">
            <div class="product-image">
              <img src="public/ff-diamond.png" alt="Diamonds" />
            </div>
            <div class="product-info">
              <span class="product-name">100</span>
              <span class="product-price">$0.83</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('310 Diamonds', 2.51, '310')">
            <div class="product-image">
              <img src="public/ff-diamond.png" alt="Diamonds" />
            </div>
            <div class="product-info">
              <span class="product-name">310</span>
              <span class="product-price">$2.51</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('520 Diamonds', 4.19, '520')">
            <div class="product-image">
              <img src="public/ff-diamond.png" alt="Diamonds" />
            </div>
            <div class="product-info">
              <span class="product-name">520</span>
              <span class="product-price">$4.19</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('1060 Diamonds', 8.25, '1060')">
            <div class="product-image">
              <img src="public/ff-diamond.png" alt="Diamonds" />
            </div>
            <div class="product-info">
              <span class="product-name">1060</span>
              <span class="product-price">$8.25</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('2180 Diamonds', 16.66, '2180')">
            <div class="product-image">
              <img src="public/ff-diamond.png" alt="Diamonds" />
            </div>
            <div class="product-info">
              <span class="product-name">2180</span>
              <span class="product-price">$16.66</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('5600 Diamonds', 41.25, '5600')">
            <div class="product-image">
              <img src="public/ff-diamond.png" alt="Diamonds" />
            </div>
            <div class="product-info">
              <span class="product-name">5600</span>
              <span class="product-price">$41.25</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('11500 Diamonds', 84.97, '11500')">
            <div class="product-image">
              <img src="public/ff-diamond.png" alt="Diamonds" />
            </div>
            <div class="product-info">
              <span class="product-name">11500</span>
              <span class="product-price">$84.97</span>
            </div>
          </div>
        </div>

        <h4 class="category-title">Subscription</h4>
        <div class="products-grid">
          <div class="product-card" onclick="selectProduct('Monthly Membership', 7.33, 'Monthly')">
            <div class="product-image">
              <img src="public/ff-monthly.png" alt="Monthly" />
            </div>
            <div class="product-info">
              <span class="product-name">Monthly</span>
              <span class="product-price">$7.33</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('Weekly Membership', 1.45, 'Weekly')">
            <div class="product-image">
              <img src="public/ff-weekly.png" alt="Weekly" />
            </div>
            <div class="product-info">
              <span class="product-name">Weekly</span>
              <span class="product-price">$1.45</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('Weekly Lite', 0.33, 'WeeklyLite')">
            <div class="product-image">
              <img src="public/ff-weekly-lite.png" alt="Weekly Lite" />
            </div>
            <div class="product-info">
              <span class="product-name">Weekly Lite</span>
              <span class="product-price">$0.33</span>
            </div>
          </div>
        </div>

        <h4 class="category-title">Evo Pass</h4>
        <div class="products-grid">
          <div class="product-card" onclick="selectProduct('Evo 3 Days', 0.52, 'Evo3D')">
            <div class="product-image">
              <img src="public/ff-evo-3d.png" alt="Evo 3D" />
            </div>
            <div class="product-info">
              <span class="product-name">Evo 3D</span>
              <span class="product-price">$0.52</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('Evo 7 Days', 0.76, 'Evo7D')">
            <div class="product-image">
              <img src="public/ff-evo-7d.png" alt="Evo 7D" />
            </div>
            <div class="product-info">
              <span class="product-name">Evo 7D</span>
              <span class="product-price">$0.76</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('Evo 30 Days', 2.28, 'Evo30D')">
            <div class="product-image">
              <img src="public/ff-evo-30d.png" alt="Evo 30D" />
            </div>
            <div class="product-info">
              <span class="product-name">Evo 30D</span>
              <span class="product-price">$2.28</span>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-top">
        <div class="contact-section">
          <span class="contact-label">Contact Us:</span>
          <div class="contact-buttons">
            <a href="https://t.me/An_Senghong" target="_blank" class="contact-btn telegram">
              <i class="fab fa-telegram"></i>
            </a>
            <a href="https://www.facebook.com/share/1ZNJiurunr/?mibextid=wwXIfr" target="_blank" class="contact-btn facebook">
              <i class="fab fa-facebook-f"></i>
            </a>
          </div>
        </div>
        <p class="copyright">Copyright 2025 <strong>Senghong Store</strong>. All Rights Reserved.</p>
        <div class="payment-methods">
          <span>We Accept:</span>
          <span class="payment-badge khqr">KHQR</span>
          <span class="payment-badge aba">ABA</span>
        </div>
      </div>
    </footer>

    <!-- Payment Modal -->
    <div class="payment-modal" id="paymentModal">
      <div class="payment-modal-content">
        <div class="modal-header">
          <h3>ការទូទាត់</h3>
          <button class="close-modal" onclick="closePaymentModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="modalBody">
          <div class="order-summary">
            <div class="order-row">
              <span class="order-label">Game:</span>
              <span class="order-value" id="orderGame">Free Fire</span>
            </div>
            <div class="order-row">
              <span class="order-label">User ID:</span>
              <span class="order-value" id="orderUserId">-</span>
            </div>
            <div class="order-row">
              <span class="order-label">Product:</span>
              <span class="order-value" id="orderProduct">-</span>
            </div>
            <div class="order-row">
              <span class="order-label">Total:</span>
              <span class="order-value total" id="orderTotal">$0.00</span>
            </div>
          </div>
          <button class="pay-now-btn" onclick="processPayment()">
            <i class="fas fa-qrcode"></i>
            បង្កើត QR Code
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="game-payment.js"></script>
  <script>
    const API_BASE = 'https://v1.camrapidx.com/validate_user/';
    const GAME_NAME = 'Free Fire';
    let verifiedUser = null;
    let selectedProduct = null;
    let paymentTimer = null;
    let timeLeft = 900;

    function toggleMenu() {
      const sideMenu = document.getElementById('sideMenu');
      const menuOverlay = document.getElementById('menuOverlay');
      sideMenu.classList.toggle('open');
      menuOverlay.classList.toggle('open');
      document.body.style.overflow = sideMenu.classList.contains('open') ? 'hidden' : '';
    }

    function showIdInfo() {
      alert('របៀបស្វែងរកលេខ User ID:\n\n1. បើកហ្គេម Free Fire\n2. ចុចលើរូបភាព Profile របស់អ្នក\n3. លេខ ID នឹងបង្ហាញនៅក្រោមឈ្មោះអ្នក');
    }

    async function checkUserId() {
      const userId = document.getElementById('userId').value.trim();
      const resultDiv = document.getElementById('verificationResult');
      const errorDiv = document.getElementById('errorMessage');

      resultDiv.style.display = 'none';
      errorDiv.style.display = 'none';
      verifiedUser = null;

      if (!userId) {
        showError('សូមបញ្ចូល User ID');
        return;
      }

      const checkBtn = document.querySelector('.check-btn');
      checkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking...';
      checkBtn.disabled = true;

      try {
        const response = await fetch(`${API_BASE}FreeFire_Global.php?UserID=${encodeURIComponent(userId)}`);
        const data = await response.json();

        if (data.status === 'APPROVED') {
          verifiedUser = {
            userId: userId,
            username: data.username
          };
          showResult(data);
        } else {
          showError(data.message || 'រកមិនឃើញ User ID។ សូមពិនិត្យម្តងទៀត។');
        }
      } catch (error) {
        showError('មានបញ្ហាក្នុងការភ្ជាប់ទៅម៉ាស៊ីនមេ។ សូមព្យាយាមម្តងទៀត។');
        console.error('API Error:', error);
      } finally {
        checkBtn.innerHTML = '<i class="fas fa-search"></i> Check User ID';
        checkBtn.disabled = false;
      }
    }

    function showResult(data) {
      const resultDiv = document.getElementById('verificationResult');
      document.getElementById('resultUsername').textContent = data.username || '-';
      resultDiv.style.display = 'block';
      resultDiv.className = 'verification-result success';
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      document.getElementById('errorText').textContent = message;
      errorDiv.style.display = 'flex';
    }

    function selectProduct(name, price, code) {
      if (!verifiedUser) {
        alert('សូមបញ្ចូល និងផ្ទៀងផ្ទាត់ User ID មុនសិន');
        return;
      }
      selectedProduct = { name, price, code };
      document.querySelectorAll('.product-card').forEach(c => c.classList.remove('selected'));
      event.currentTarget.classList.add('selected');
      showPaymentModal();
    }

    function showPaymentModal() {
      document.getElementById('orderGame').textContent = GAME_NAME;
      document.getElementById('orderUserId').textContent = verifiedUser.userId;
      document.getElementById('orderProduct').textContent = selectedProduct.name;
      document.getElementById('orderTotal').textContent = '$' + selectedProduct.price.toFixed(2);
      document.getElementById('paymentModal').classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closePaymentModal() {
      document.getElementById('paymentModal').classList.remove('show');
      document.body.style.overflow = '';
      GamePayment.stopPaymentCheck();
      if (paymentTimer) {
        clearInterval(paymentTimer);
        paymentTimer = null;
      }
      resetModalBody();
    }

    function resetModalBody() {
      document.getElementById('modalBody').innerHTML = `
        <div class="order-summary">
          <div class="order-row">
            <span class="order-label">Game:</span>
            <span class="order-value" id="orderGame">${GAME_NAME}</span>
          </div>
          <div class="order-row">
            <span class="order-label">User ID:</span>
            <span class="order-value" id="orderUserId">${verifiedUser?.userId || '-'}</span>
          </div>
          <div class="order-row">
            <span class="order-label">Product:</span>
            <span class="order-value" id="orderProduct">${selectedProduct?.name || '-'}</span>
          </div>
          <div class="order-row">
            <span class="order-label">Total:</span>
            <span class="order-value total" id="orderTotal">$${selectedProduct?.price?.toFixed(2) || '0.00'}</span>
          </div>
        </div>
        <button class="pay-now-btn" onclick="processPayment()">
          <i class="fas fa-qrcode"></i>
          បង្កើត QR Code
        </button>
      `;
    }

    async function processPayment() {
      const btn = document.querySelector('.pay-now-btn');
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> កំពុងបង្កើត...';
      btn.disabled = true;

      try {
        const orderInfo = {
          game: GAME_NAME,
          userId: verifiedUser.userId,
          nickname: verifiedUser.username,
          product: selectedProduct.name,
          productCode: selectedProduct.code,
          amount: selectedProduct.price.toFixed(2)
        };

        const transaction = await GamePayment.createPayment(selectedProduct.price, orderInfo);
        showQRCode(transaction);
      } catch (error) {
        alert('មានបញ្ហាក្នុងការបង្កើត QR Code។ សូមព្យាយាមម្តងទៀត។');
        btn.innerHTML = '<i class="fas fa-qrcode"></i> បង្កើត QR Code';
        btn.disabled = false;
      }
    }

    function showQRCode(transaction) {
      timeLeft = 900;
      document.getElementById('modalBody').innerHTML = `
        <div class="qr-section">
          <img src="${transaction.qrUrl}" alt="QR Code" class="qr-image" />
          <div class="timer-section">
            <i class="fas fa-clock"></i>
            <span id="timerDisplay">${GamePayment.formatTime(timeLeft)}</span>
          </div>
          <div class="checking-status">
            <i class="fas fa-spinner fa-spin"></i>
            <span>កំពុងរង់ចាំការទូទាត់...</span>
          </div>
        </div>
      `;

      paymentTimer = setInterval(() => {
        timeLeft--;
        document.getElementById('timerDisplay').textContent = GamePayment.formatTime(timeLeft);
        if (timeLeft <= 0) {
          clearInterval(paymentTimer);
          closePaymentModal();
          alert('QR Code បានផុតកំណត់។ សូមព្យាយាមម្តងទៀត។');
        }
      }, 1000);

      GamePayment.startPaymentCheck(
        (result) => {
          clearInterval(paymentTimer);
          showPaymentSuccess();
        },
        (error) => {
          console.error('Payment check error:', error);
        }
      );
    }

    function showPaymentSuccess() {
      const orderInfo = GamePayment.currentTransaction?.orderInfo || {
        game: GAME_NAME,
        userId: verifiedUser?.userId || '-',
        product: selectedProduct?.name || '-',
        amount: selectedProduct?.price?.toFixed(2) || '0.00'
      };
      document.getElementById('modalBody').innerHTML = GamePayment.getSuccessPageHTML(orderInfo);
      setTimeout(() => {
        closePaymentModal();
        document.querySelectorAll('.product-card').forEach(c => c.classList.remove('selected'));
        selectedProduct = null;
      }, 8000);
    }
  </script>
</body>

</html>