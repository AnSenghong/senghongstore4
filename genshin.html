<!DOCTYPE html>
<html lang="km">

<head>
  <title>Genshin Impact - Senghong Store</title>
  <meta property="og:title" content="Genshin Impact - Senghong Store" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <link rel="shortcut icon" href="public/senghong-logo.png" type="image/png" sizes="32x32" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Khmer:wght@100;200;300;400;500;600;700;800;900&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="./product.css" />
</head>

<body>
  <div class="page-container">
    <header class="header">
      <div class="header-left">
        <a href="index.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
        </a>
        <img alt="Senghong Store Logo" src="./public/senghong-logo.png" class="logo" />
      </div>
      <div class="header-right">
        <button class="icon-btn menu-btn" onclick="toggleMenu()">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </header>

    <div class="side-menu" id="sideMenu">
      <div class="menu-header">
        <img src="public/senghong-logo.png" alt="Logo" class="menu-logo" />
        <span class="menu-title">Senghong Store</span>
        <button class="close-menu" onclick="toggleMenu()"><i class="fas fa-times"></i></button>
      </div>
      <nav class="menu-nav">
        <a href="index.html" class="menu-item"><i class="fas fa-home"></i> Home</a>
        <a href="genshin.html" class="menu-item active"><i class="fas fa-gamepad"></i> Genshin Impact</a>
        <a href="terms.html" class="menu-item"><i class="fas fa-file-alt"></i> Terms & Conditions</a>
        <a href="https://t.me/An_Senghong" target="_blank" class="menu-item"><i class="fab fa-telegram"></i> Telegram</a>
      </nav>
      <div class="menu-footer">
        <p>Version 1.0</p>
      </div>
    </div>
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <section class="product-banner">
      <img src="public/banner1.jpg" alt="Genshin Impact Banner" class="banner-image" />
      <div class="banner-overlay">
        <h1 class="banner-title">Genshin Impact</h1>
      </div>
    </section>

    <main class="main-content">
      <div class="game-info-card">
        <div class="game-icon-wrapper">
          <img src="public/genshin-impact.jpg" alt="Genshin Impact" class="game-icon" />
        </div>
        <div class="game-details">
          <h2 class="game-name">Genshin Impact</h2>
          <div class="game-features">
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>áŸáŸáœá¶á€á˜áŸ’á˜á”áŸ’ášá€á”áŠáŸ„á™áŸá»áœááŸ’áá·á—á¶á–</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-clock"></i>
              <span>24h áŠáŸ†áá¾ášá€á¶ášášá áŸáŸášá á½á“</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-headset"></i>
              <span>áŸáŸáœá¶á¢áá·áá·á‡á“á‚á¶áŸ†á‘áŸ’áš</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-globe"></i>
              <span>All Servers</span>
            </div>
          </div>
        </div>
      </div>

      <div class="game-description">
        <p>Genshin Impact is an open-world action RPG by miHoYo. Explore the vast world of Teyvat, master elemental combat, and uncover the secrets of the Seven Archons.</p>
      </div>

      <div class="verification-section">
        <div class="section-header-box">
          <span class="step-number">1</span>
          <h3>á”á‰áŸ’á‡á¼á›á›áŸáá¢á¶á™áŒá¸</h3>
          <button class="info-btn" onclick="showIdInfo()">
            <i class="fas fa-question-circle"></i>
          </button>
        </div>

        <div class="form-group">
          <label for="userId">User ID (UID) <span class="required">*</span></label>
          <input type="text" id="userId" placeholder="User ID" class="form-input" />
        </div>

        <button class="check-btn" onclick="checkUserId()">
          <i class="fas fa-search"></i>
          Check User ID
        </button>

        <div class="verification-result" id="verificationResult" style="display: none;">
          <div class="result-content">
            <div class="result-icon" id="resultIcon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="result-info">
              <span class="result-label">Username:</span>
              <span class="result-value" id="resultUsername">-</span>
            </div>
          </div>
        </div>

        <div class="error-message" id="errorMessage" style="display: none;">
          <i class="fas fa-exclamation-triangle"></i>
          <span id="errorText">Error message here</span>
        </div>
      </div>

      <div class="products-section">
        <div class="section-header-box">
          <span class="step-number">2</span>
          <h3>á‡áŸ’ášá¾áŸášá¾áŸá€á‰áŸ’á…á”áŸ‹</h3>
        </div>
        <p class="section-subtitle"><i class="fas fa-star" style="color: #ffc107;"></i> Recommended for You</p>

        <h4 class="category-title">ğŸ’ Genesis Crystals</h4>
        <div class="products-grid">
          <div class="product-card" onclick="selectProduct('60 Genesis Crystals', 0.89, '60')">
            <div class="product-image">
              <img src="attached_assets/IMG_3765_1765711374791.WEBP" alt="Genesis Crystals" />
            </div>
            <div class="product-info">
              <span class="product-name">60 ğŸ’</span>
              <span class="product-price">$0.89</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('330 Genesis Crystals', 3.89, '330')">
            <div class="product-image">
              <img src="attached_assets/IMG_3765_1765711374791.WEBP" alt="Genesis Crystals" />
            </div>
            <div class="product-info">
              <span class="product-name">330 ğŸ’</span>
              <span class="product-price">$3.89</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('1090 Genesis Crystals', 10.89, '1090')">
            <div class="product-image">
              <img src="attached_assets/IMG_3765_1765711374791.WEBP" alt="Genesis Crystals" />
            </div>
            <div class="product-info">
              <span class="product-name">1090 ğŸ’</span>
              <span class="product-price">$10.89</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('2240 Genesis Crystals', 23.59, '2240')">
            <div class="product-image">
              <img src="attached_assets/IMG_3765_1765711374791.WEBP" alt="Genesis Crystals" />
            </div>
            <div class="product-info">
              <span class="product-name">2240 ğŸ’</span>
              <span class="product-price">$23.59</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('3880 Genesis Crystals', 38.00, '3880')">
            <div class="product-image">
              <img src="attached_assets/IMG_3765_1765711374791.WEBP" alt="Genesis Crystals" />
            </div>
            <div class="product-info">
              <span class="product-name">3880 ğŸ’</span>
              <span class="product-price">$38.00</span>
            </div>
          </div>
          <div class="product-card" onclick="selectProduct('8080 Genesis Crystals', 75.00, '8080')">
            <div class="product-image">
              <img src="attached_assets/IMG_3765_1765711374791.WEBP" alt="Genesis Crystals" />
            </div>
            <div class="product-info">
              <span class="product-name">8080 ğŸ’</span>
              <span class="product-price">$75.00</span>
            </div>
          </div>
        </div>

        <h4 class="category-title">ğŸŒ™ Special</h4>
        <div class="products-grid">
          <div class="product-card" onclick="selectProduct('Blessing of Welkin Moon', 3.89, 'Welkin')">
            <div class="product-image">
              <img src="attached_assets/IMG_3766_1765711381056.WEBP" alt="Welkin Moon" />
            </div>
            <div class="product-info">
              <span class="product-name">Welkin Moon</span>
              <span class="product-price">$3.89</span>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-top">
        <div class="contact-section">
          <span class="contact-label">Contact Us:</span>
          <div class="contact-buttons">
            <a href="https://t.me/An_Senghong" target="_blank" class="contact-btn telegram">
              <i class="fab fa-telegram"></i>
            </a>
            <a href="https://www.facebook.com/share/1ZNJiurunr/?mibextid=wwXIfr" target="_blank" class="contact-btn facebook">
              <i class="fab fa-facebook-f"></i>
            </a>
          </div>
        </div>
        <p class="copyright">Copyright 2025 <strong>Senghong Store</strong>. All Rights Reserved.</p>
        <div class="payment-methods">
          <span>We Accept:</span>
          <span class="payment-badge khqr">KHQR</span>
          <span class="payment-badge aba">ABA</span>
        </div>
      </div>
    </footer>

    <!-- Payment Modal -->
    <div class="payment-modal" id="paymentModal">
      <div class="payment-modal-content">
        <div class="modal-header">
          <h3>á€á¶ášá‘á¼á‘á¶ááŸ‹</h3>
          <button class="close-modal" onclick="closePaymentModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="modalBody">
          <div class="order-summary">
            <div class="order-row">
              <span class="order-label">Game:</span>
              <span class="order-value" id="orderGame">Genshin Impact</span>
            </div>
            <div class="order-row">
              <span class="order-label">User ID:</span>
              <span class="order-value" id="orderUserId">-</span>
            </div>
            <div class="order-row">
              <span class="order-label">Product:</span>
              <span class="order-value" id="orderProduct">-</span>
            </div>
            <div class="order-row">
              <span class="order-label">Total:</span>
              <span class="order-value total" id="orderTotal">$0.00</span>
            </div>
          </div>
          <button class="pay-now-btn" onclick="processPayment()">
            <i class="fas fa-qrcode"></i>
            á”á„áŸ’á€á¾á QR Code
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="game-payment.js"></script>
  <script>
    const API_BASE = 'https://v1.camrapidx.com/validate_user/';
    const GAME_NAME = 'Genshin Impact';
    let verifiedUser = null;
    let selectedProduct = null;
    let paymentTimer = null;
    let timeLeft = 900;

    function toggleMenu() {
      const sideMenu = document.getElementById('sideMenu');
      const menuOverlay = document.getElementById('menuOverlay');
      sideMenu.classList.toggle('open');
      menuOverlay.classList.toggle('open');
      document.body.style.overflow = sideMenu.classList.contains('open') ? 'hidden' : '';
    }

    function showIdInfo() {
      alert('ášá”áŸ€á”áŸáŸ’áœáŸ‚á„ášá€á›áŸá UID:\n\n1. á”á¾á€á áŸ’á‚áŸá˜ Genshin Impact\n2. á…á»á…á›á¾ Paimon Menu\n3. UID á“á¹á„á”á„áŸ’á á¶á‰á“áŸ…á•áŸ’á“áŸ‚á€áá¶á„á€áŸ’ášáŸ„á˜áŸáŸ’áá¶áŸ†');
    }

    async function checkUserId() {
      const userId = document.getElementById('userId').value.trim();
      const resultDiv = document.getElementById('verificationResult');
      const errorDiv = document.getElementById('errorMessage');

      resultDiv.style.display = 'none';
      errorDiv.style.display = 'none';
      verifiedUser = null;

      if (!userId) {
        showError('áŸá¼á˜á”á‰áŸ’á…á¼á› User ID');
        return;
      }

      const checkBtn = document.querySelector('.check-btn');
      checkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking...';
      checkBtn.disabled = true;

      try {
        const response = await fetch(`${API_BASE}Genshin_Impact.php?UserID=${encodeURIComponent(userId)}`);
        const data = await response.json();

        if (data.status === 'APPROVED') {
          verifiedUser = {
            userId: userId,
            username: data.username
          };
          showResult(data);
        } else {
          showError(data.message || 'ášá€á˜á·á“áƒá¾á‰ User IDáŸ” áŸá¼á˜á–á·á“á·ááŸ’á™á˜áŸ’áá„á‘áŸ€ááŸ”');
        }
      } catch (error) {
        showError('á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá—áŸ’á‡á¶á”áŸ‹á‘áŸ…á˜áŸ‰á¶áŸáŸŠá¸á“á˜áŸáŸ” áŸá¼á˜á–áŸ’á™á¶á™á¶á˜á˜áŸ’áá„á‘áŸ€ááŸ”');
        console.error('API Error:', error);
      } finally {
        checkBtn.innerHTML = '<i class="fas fa-search"></i> Check User ID';
        checkBtn.disabled = false;
      }
    }

    function showResult(data) {
      const resultDiv = document.getElementById('verificationResult');
      document.getElementById('resultUsername').textContent = data.username || '-';
      resultDiv.style.display = 'block';
      resultDiv.className = 'verification-result success';
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      document.getElementById('errorText').textContent = message;
      errorDiv.style.display = 'flex';
    }

    function selectProduct(name, price, code) {
      if (!verifiedUser) {
        alert('áŸá¼á˜á”á‰áŸ’á…á¼á› á“á·á„á•áŸ’á‘áŸ€á„á•áŸ’á‘á¶ááŸ‹ User ID á˜á»á“áŸá·á“');
        return;
      }
      selectedProduct = { name, price, code };
      document.querySelectorAll('.product-card').forEach(c => c.classList.remove('selected'));
      event.currentTarget.classList.add('selected');
      showPaymentModal();
    }

    function showPaymentModal() {
      document.getElementById('orderGame').textContent = GAME_NAME;
      document.getElementById('orderUserId').textContent = verifiedUser.userId;
      document.getElementById('orderProduct').textContent = selectedProduct.name;
      document.getElementById('orderTotal').textContent = '$' + selectedProduct.price.toFixed(2);
      document.getElementById('paymentModal').classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closePaymentModal() {
      document.getElementById('paymentModal').classList.remove('show');
      document.body.style.overflow = '';
      GamePayment.stopPaymentCheck();
      if (paymentTimer) {
        clearInterval(paymentTimer);
        paymentTimer = null;
      }
      resetModalBody();
    }

    function resetModalBody() {
      document.getElementById('modalBody').innerHTML = `
        <div class="order-summary">
          <div class="order-row">
            <span class="order-label">Game:</span>
            <span class="order-value" id="orderGame">${GAME_NAME}</span>
          </div>
          <div class="order-row">
            <span class="order-label">User ID:</span>
            <span class="order-value" id="orderUserId">${verifiedUser?.userId || '-'}</span>
          </div>
          <div class="order-row">
            <span class="order-label">Product:</span>
            <span class="order-value" id="orderProduct">${selectedProduct?.name || '-'}</span>
          </div>
          <div class="order-row">
            <span class="order-label">Total:</span>
            <span class="order-value total" id="orderTotal">$${selectedProduct?.price?.toFixed(2) || '0.00'}</span>
          </div>
        </div>
        <button class="pay-now-btn" onclick="processPayment()">
          <i class="fas fa-qrcode"></i>
          á”á„áŸ’á€á¾á QR Code
        </button>
      `;
    }

    async function processPayment() {
      const btn = document.querySelector('.pay-now-btn');
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> á€áŸ†á–á»á„á”á„áŸ’á€á¾á...';
      btn.disabled = true;

      try {
        const orderInfo = {
          game: GAME_NAME,
          userId: verifiedUser.userId,
          nickname: verifiedUser.username,
          product: selectedProduct.name,
          productCode: selectedProduct.code,
          amount: selectedProduct.price.toFixed(2)
        };

        const transaction = await GamePayment.createPayment(selectedProduct.price, orderInfo);
        showQRCode(transaction);
      } catch (error) {
        alert('á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá”á„áŸ’á€á¾á QR CodeáŸ” áŸá¼á˜á–áŸ’á™á¶á™á¶á˜á˜áŸ’áá„á‘áŸ€ááŸ”');
        btn.innerHTML = '<i class="fas fa-qrcode"></i> á”á„áŸ’á€á¾á QR Code';
        btn.disabled = false;
      }
    }

    function showQRCode(transaction) {
      timeLeft = 900;
      document.getElementById('modalBody').innerHTML = `
        <div class="qr-section">
          <img src="${transaction.qrUrl}" alt="QR Code" class="qr-image" />
          <div class="timer-section">
            <i class="fas fa-clock"></i>
            <span id="timerDisplay">${GamePayment.formatTime(timeLeft)}</span>
          </div>
          <div class="checking-status">
            <i class="fas fa-spinner fa-spin"></i>
            <span>á€áŸ†á–á»á„ášá„áŸ‹á…á¶áŸ†á€á¶ášá‘á¼á‘á¶ááŸ‹...</span>
          </div>
        </div>
      `;

      paymentTimer = setInterval(() => {
        timeLeft--;
        document.getElementById('timerDisplay').textContent = GamePayment.formatTime(timeLeft);
        if (timeLeft <= 0) {
          clearInterval(paymentTimer);
          closePaymentModal();
          alert('QR Code á”á¶á“á•á»áá€áŸ†áááŸ‹áŸ” áŸá¼á˜á–áŸ’á™á¶á™á¶á˜á˜áŸ’áá„á‘áŸ€ááŸ”');
        }
      }, 1000);

      GamePayment.startPaymentCheck(
        (result) => {
          clearInterval(paymentTimer);
          showPaymentSuccess();
        },
        (error) => {
          console.error('Payment check error:', error);
        }
      );
    }

    function showPaymentSuccess() {
      const orderInfo = { game: GAME_NAME, userId: verifiedUser.userId, product: selectedProduct.name, amount: selectedProduct.price.toFixed(2) };
      document.getElementById('modalBody').innerHTML = GamePayment.getSuccessPageHTML(orderInfo);
      setTimeout(() => { closePaymentModal(); document.querySelectorAll('.product-card').forEach(c => c.classList.remove('selected')); selectedProduct = null; }, 8000);
    }
  </script>
</body>

</html>